<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Dashboard del Estudiante ‚Äì Guardianes del Desierto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
      :root {
        --cobre: #b87333;
        --cian: #00e5ff;
        --oscuro: #080c12;
        --texto: #f9fafb;
        --gris-suave: #9ca3af;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
        color: var(--texto);
      }

      a { text-decoration: none; color: inherit; }

      .topbar {
        width: 100%;
        padding: 14px 24px;
        background: rgba(8, 12, 18, 0.9);
        border-bottom: 1px solid rgba(184, 115, 51, 0.35);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(10px);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        font-size: 0.95rem;
      }

      .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 2px solid var(--cobre);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      nav {
        display: flex;
        gap: 16px;
        font-size: 0.9rem;
      }

      nav a {
        padding: 6px 10px;
        border-radius: 999px;
        color: var(--gris-suave);
      }

      nav a:hover {
        color: var(--texto);
        background: rgba(184, 115, 51, 0.15);
      }

      .container {
        max-width: 1040px;
        margin: 0 auto;
        padding: 24px 16px 40px;
      }

      h1 {
        font-size: clamp(1.6rem, 3vw, 2rem);
        margin: 0 0 8px;
      }

      .subtitle {
        margin: 0 0 18px;
        color: var(--gris-suave);
        font-size: 0.95rem;
      }

      .grid {
        display: grid;
        grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
        gap: 20px;
        margin-top: 10px;
      }

      .card {
        border-radius: 16px;
        padding: 16px 16px 14px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(30, 64, 175, 0.6);
      }

      .card h2 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      label {
        display: block;
        font-size: 0.85rem;
        margin-bottom: 4px;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"],
      textarea,
      select {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.9);
        background: rgba(15, 23, 42, 0.95);
        color: var(--texto);
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      .btn,
      .btn-secundario {
        display: inline-block;
        padding: 9px 16px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        border: none;
      }

      .btn {
        background: linear-gradient(135deg, var(--cobre), #d88a4d);
        color: #000;
      }

      .btn:hover {
        filter: brightness(1.05);
        transform: translateY(-1px);
      }

      .btn-secundario {
        background: transparent;
        color: var(--cian);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .btn-secundario:hover {
        border-color: var(--cian);
      }

      .small {
        font-size: 0.8rem;
        color: var(--gris-suave);
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        padding: 4px 9px;
        border-radius: 999px;
        background: rgba(8, 47, 73, 0.9);
        color: #7dd3fc;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 8px;
      }

      .perfil-item {
        font-size: 0.9rem;
        margin-bottom: 6px;
      }

      .perfil-item span {
        color: var(--gris-suave);
      }

      .pill-warning {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        font-size: 0.78rem;
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(180, 83, 9, 0.3);
        color: #fed7aa;
        margin-bottom: 8px;
      }

      footer {
        margin-top: 32px;
        padding: 18px 16px 22px;
        border-top: 1px solid rgba(31, 41, 55, 0.9);
        text-align: center;
        font-size: 0.83rem;
        color: var(--gris-suave);
        background: rgba(8, 12, 18, 0.96);
      }

      footer span.icon {
        color: #ef4444;
      }

      footer span.fox {
        font-size: 1.1rem;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="brand-logo">ü¶ä</div>
        <div>
          Guardianes del Desierto<br>
          <small style="font-weight: 400; font-size: 0.7rem; color: #9ca3af;">
            Dashboard del estudiante
          </small>
        </div>
      </div>
      <nav>
        <a href="index.html">‚Üê Volver al portal</a>
      </nav>
    </header>

    <main class="container">
      <h1>Dashboard del estudiante</h1>
      <p class="subtitle">
        Aqu√≠ puedes registrar tu perfil como Guardi√°n del Desierto y dejar evidencia
        de tu participaci√≥n en el CTF y los talleres. La informaci√≥n se guarda
        √∫nicamente en este dispositivo.
      </p>

      <div class="grid">
        <section class="card" id="perfil-card">
          <h2>Configuraci√≥n de perfil</h2>
          <div class="tag">Paso 1 ¬∑ Crear o actualizar tu perfil</div>
          <p class="small">
            Completa tus datos y define un <strong>PIN</strong> para proteger tu panel.
            Este PIN ser√° necesario para volver a ver tu informaci√≥n.
          </p>

          <form id="perfil-form">
            <label for="nombre">Nombre completo</label>
            <input type="text" id="nombre" required placeholder="Ej: Ana P√©rez">

            <label for="curso">Curso</label>
            <input type="text" id="curso" required placeholder="Ej: 7¬∞ b√°sico A">

            <label for="correo">Correo institucional SLEP</label>
            <input type="email" id="correo" required placeholder="Ej: nombre.apellido@slep.cl">

            <label for="taller">Taller principal en el que participas</label>
            <select id="taller">
              <option value="">Selecciona una opci√≥n</option>
              <option value="robotica">Rob√≥tica con Tinkercad</option>
              <option value="familia">Seguridad en familia</option>
              <option value="ctf">CTF Escolar / Desaf√≠os</option>
              <option value="otro">Otro / M√°s de uno</option>
            </select>

            <label for="pin">PIN de acceso (4 a 6 d√≠gitos)</label>
            <input type="password" id="pin" minlength="4" maxlength="6" required
                   placeholder="Ej: 1234">

            <p class="small" style="margin-top: -4px; margin-bottom: 10px;">
              No compartas tu PIN con otras personas. Si lo olvidas, deber√°s borrar
              los datos y crear tu perfil nuevamente.
            </p>

            <button type="submit" class="btn">Guardar perfil</button>
            <button type="button" class="btn-secundario" id="btn-limpiar">
              Borrar datos de este dispositivo
            </button>
          </form>

          <div id="mensaje-estado" class="small" style="margin-top: 10px;"></div>
        </section>

        <section class="card">
          <h2>Acceso y evidencias</h2>
          <div class="tag" style="background: rgba(22, 101, 52, 0.75); color: #bbf7d0;">
            Paso 2 ¬∑ Desbloquear y registrar
          </div>
          <p class="small">
            Una vez creado tu perfil, puedes usar tu PIN para desbloquearlo y ver
            tus datos. Tambi√©n puedes anotar tus logros, puntajes, desaf√≠os completados
            o reflexiones.
          </p>

          <div id="bloqueo-panel">
            <label for="pin-acceso">Ingresa tu PIN para ver el perfil</label>
            <input type="password" id="pin-acceso" minlength="4" maxlength="6"
                   placeholder="PIN de tu perfil">
            <button type="button" class="btn" id="btn-desbloquear">
              Desbloquear perfil
            </button>
            <div class="small" id="mensaje-acceso" style="margin-top: 8px;"></div>
          </div>

          <div id="contenido-panel" style="display: none; margin-top: 10px;">
            <div class="pill-warning">
              Datos visibles. Recuerda cerrar este panel si compartes el dispositivo.
            </div>

            <div id="perfil-detalle" style="margin-bottom: 12px;"></div>

            <h3 style="font-size: 1rem; margin-top: 14px;">Mis evidencias</h3>
            <p class="small">
              Escribe aqu√≠ un resumen de tus actividades: desaf√≠os que completaste,
              qu√© aprendiste en los talleres, o ideas que quieras recordar.
            </p>
            <textarea id="evidencias" placeholder="Ej: Resolv√≠ el reto de esteganograf√≠a, aprend√≠ a..."></textarea>
            <button type="button" class="btn" id="btn-guardar-evidencias">
              Guardar evidencias
            </button>
            <span class="small" id="estado-evidencias" style="margin-left: 6px;"></span>
          </div>
        </section>
      </div>
    </main>

    <footer>
      Desarrollado con mucho <span class="icon">‚ù§Ô∏è</span> por
      <strong>Luis Jofr√© P√©rez</strong> ‚Äì Escuela Las Canteras, Copiap√≥, Atacama üåµ
      <br>
      ¬© 2025 Guardianes del Desierto <span class="fox">ü¶ä</span>
    </footer>

    <script>
      const STORAGE_KEY_PERFIL = "gd_perfil_cifrado";
      const STORAGE_KEY_EVIDENCIAS = "gd_evidencias";

      function cifrarTexto(texto, pin) {
        // Cifrado sencillo tipo XOR + base64 (solo ofuscaci√≥n local)
        const t = String(texto);
        const p = String(pin || "0");
        let resultado = "";
        for (let i = 0; i < t.length; i++) {
          const charCode = t.charCodeAt(i) ^ p.charCodeAt(i % p.length);
          resultado += String.fromCharCode(charCode);
        }
        return btoa(resultado);
      }

      function descifrarTexto(cifrado, pin) {
        const p = String(pin || "0");
        const texto = atob(cifrado);
        let resultado = "";
        for (let i = 0; i < texto.length; i++) {
          const charCode = texto.charCodeAt(i) ^ p.charCodeAt(i % p.length);
          resultado += String.fromCharCode(charCode);
        }
        return resultado;
      }

      const formPerfil = document.getElementById("perfil-form");
      const mensajeEstado = document.getElementById("mensaje-estado");
      const btnLimpiar = document.getElementById("btn-limpiar");

      const inputPinAcceso = document.getElementById("pin-acceso");
      const btnDesbloquear = document.getElementById("btn-desbloquear");
      const mensajeAcceso = document.getElementById("mensaje-acceso");
      const contenidoPanel = document.getElementById("contenido-panel");
      const perfilDetalle = document.getElementById("perfil-detalle");

      const evidenciasTextarea = document.getElementById("evidencias");
      const btnGuardarEvidencias = document.getElementById("btn-guardar-evidencias");
      const estadoEvidencias = document.getElementById("estado-evidencias");

      formPerfil.addEventListener("submit", (e) => {
        e.preventDefault();
        const nombre = document.getElementById("nombre").value.trim();
        const curso = document.getElementById("curso").value.trim();
        const correo = document.getElementById("correo").value.trim();
        const taller = document.getElementById("taller").value;
        const pin = document.getElementById("pin").value.trim();

        if (!nombre || !curso || !correo || !pin) {
          mensajeEstado.textContent = "Por favor, completa todos los datos obligatorios.";
          mensajeEstado.style.color = "#fecaca";
          return;
        }

        if (pin.length < 4 || pin.length > 6) {
          mensajeEstado.textContent = "El PIN debe tener entre 4 y 6 d√≠gitos.";
          mensajeEstado.style.color = "#fed7aa";
          return;
        }

        const perfil = { nombre, curso, correo, taller };
        const textoPlano = JSON.stringify(perfil);
        const cifrado = cifrarTexto(textoPlano, pin);

        try {
          localStorage.setItem(STORAGE_KEY_PERFIL, cifrado);
          mensajeEstado.textContent = "Perfil guardado correctamente en este dispositivo.";
          mensajeEstado.style.color = "#bbf7d0";
        } catch (err) {
          mensajeEstado.textContent = "No se pudo guardar el perfil (revisa espacio disponible).";
          mensajeEstado.style.color = "#fecaca";
        }
      });

      btnLimpiar.addEventListener("click", () => {
        if (!confirm("Esto borrar√° el perfil y las evidencias almacenadas en este dispositivo. ¬øContinuar?")) {
          return;
        }
        localStorage.removeItem(STORAGE_KEY_PERFIL);
        localStorage.removeItem(STORAGE_KEY_EVIDENCIAS);
        evidenciasTextarea.value = "";
        contenidoPanel.style.display = "none";
        mensajeEstado.textContent = "Datos eliminados de este dispositivo.";
        mensajeEstado.style.color = "#fecaca";
        mensajeAcceso.textContent = "";
        perfilDetalle.innerHTML = "";
      });

      btnDesbloquear.addEventListener("click", () => {
        const pin = inputPinAcceso.value.trim();
        if (!pin) {
          mensajeAcceso.textContent = "Ingresa tu PIN para desbloquear el perfil.";
          mensajeAcceso.style.color = "#fecaca";
          return;
        }

        const cifrado = localStorage.getItem(STORAGE_KEY_PERFIL);
        if (!cifrado) {
          mensajeAcceso.textContent = "No se encontr√≥ un perfil guardado. Crea uno en el formulario de la izquierda.";
          mensajeAcceso.style.color = "#fed7aa";
          return;
        }

        try {
          const textoPlano = descifrarTexto(cifrado, pin);
          const perfil = JSON.parse(textoPlano);
          mostrarPerfil(perfil);
          cargarEvidencias();
          contenidoPanel.style.display = "block";
          mensajeAcceso.textContent = "Perfil desbloqueado correctamente.";
          mensajeAcceso.style.color = "#bbf7d0";
        } catch (err) {
          mensajeAcceso.textContent = "PIN incorrecto o datos da√±ados.";
          mensajeAcceso.style.color = "#fecaca";
          contenidoPanel.style.display = "none";
        }
      });

      function mostrarPerfil(perfil) {
        const tallerLabel =
          perfil.taller === "robotica" ? "Rob√≥tica con Tinkercad" :
          perfil.taller === "familia" ? "Seguridad en familia" :
          perfil.taller === "ctf" ? "CTF Escolar / Desaf√≠os" :
          perfil.taller === "otro" ? "Otro / M√°s de uno" :
          "No especificado";

        perfilDetalle.innerHTML = `
          <div class="perfil-item"><span>Nombre:</span> <strong>${perfil.nombre || "-"}</strong></div>
          <div class="perfil-item"><span>Curso:</span> <strong>${perfil.curso || "-"}</strong></div>
          <div class="perfil-item"><span>Correo SLEP:</span> <strong>${perfil.correo || "-"}</strong></div>
          <div class="perfil-item"><span>Taller principal:</span> <strong>${tallerLabel}</strong></div>
        `;
      }

      function cargarEvidencias() {
        const texto = localStorage.getItem(STORAGE_KEY_EVIDENCIAS) || "";
        evidenciasTextarea.value = texto;
      }

      btnGuardarEvidencias.addEventListener("click", () => {
        const texto = evidenciasTextarea.value || "";
        try {
          localStorage.setItem(STORAGE_KEY_EVIDENCIAS, texto);
          estadoEvidencias.textContent = "Evidencias guardadas.";
          estadoEvidencias.style.color = "#bbf7d0";
          setTimeout(() => {
            estadoEvidencias.textContent = "";
          }, 2500);
        } catch (err) {
          estadoEvidencias.textContent = "No se pudo guardar (revisa espacio disponible).";
          estadoEvidencias.style.color = "#fecaca";
        }
      });

      // Auto-cargar evidencias si ya exist√≠an (aunque el perfil est√© bloqueado)
      const evidenciasPrevias = localStorage.getItem(STORAGE_KEY_EVIDENCIAS);
      if (evidenciasPrevias) {
        evidenciasTextarea.value = evidenciasPrevias;
      }
    </script>
  </body>
</html>
